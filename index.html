<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Vowels Level Up! ğŸš€</title>
    <style>
        :root { --pink: #f8a5c2; --blue: #778beb; --bg: #fffbe6; --gold: #feca57; --accent: #54a0ff; --green: #b2ff59; }
        body { font-family: 'Arial Rounded MT Bold', sans-serif; background-color: var(--bg); text-align: center; margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; padding: 25px; background: white; border-radius: 40px; box-shadow: 0 15px 0 #f0e68c; min-height: 90vh; }
        
        .header { color: var(--accent); font-size: 32px; font-weight: bold; margin-bottom: 10px; }
        .stars { font-size: 45px; color: var(--gold); margin-bottom: 15px; min-height: 60px; }
        .victory-jump { animation: jump 0.5s ease infinite alternate; }
        @keyframes jump { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        /* é•·æ¯éŸ³é¸å–® */
        .vowel-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .vowel-item { padding: 20px; background: #e3f2fd; color: #1976D2; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 28px; border: 1px solid #bbdefb; box-shadow: 0 5px #90caf9; }
        .vowel-item:active { transform: translateY(3px); box-shadow: none; }

        /* åœ“åœˆæŒ‰éˆ• */
        .choice-container { display: flex; justify-content: space-around; margin: 30px 0; }
        .circle-btn { width: 145px; height: 145px; border-radius: 50%; border: 8px solid white; font-size: 26px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 8px 0 rgba(0,0,0,0.05); }
        .circle-btn.pink { background-color: var(--pink); color: #ad1457; }
        .circle-btn.blue { background-color: #e1f5fe; color: #0288d1; }

        /* éŒ„éŸ³èˆ‡æ§åˆ¶å€ */
        .recording-box { background: #fdfdfd; border: 2px solid #f0f0f0; border-radius: 30px; padding: 20px; margin-top: 20px; }
        .rec-btn { width: 75px; height: 75px; border-radius: 50%; border: none; background: #ff5252; color: white; font-size: 32px; cursor: pointer; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(255,82,82,0.3); }
        .play-voice-btn { width: 100%; background: var(--green); border: none; padding: 15px; border-radius: 25px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #8bc34a; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div id="menu-view">
        <h2 class="header">Long Vowel World ğŸš€</h2>
        <div class="stars">âœ¨âœ¨âœ¨</div>
        <p style="color: #888; margin-bottom: 20px;">Pick a Sound to Start!</p>
        <div class="vowel-grid">
            <div class="vowel-item" onclick="startLevel('a_e')">a_e</div>
            <div class="vowel-item" onclick="startLevel('i_e')">i_e</div>
            <div class="vowel-item" onclick="startLevel('o_e')">o_e</div>
            <div class="vowel-item" onclick="startLevel('u_e')">u_e</div>
            <div class="vowel-item" onclick="startLevel('ee')">ee</div>
            <div class="vowel-item" onclick="startLevel('ea')">ea</div>
        </div>
    </div>

    <div id="game-view" class="hidden">
        <div class="header" id="current-vowel-display">Long Vowel: a_e</div>
        <div class="stars" id="star-display">â˜†â˜†â˜†â˜†â˜†</div>
        
        <div class="choice-container">
            <button id="opt1" class="circle-btn pink" onclick="checkAnswer(this)"></button>
            <button id="opt2" class="circle-btn blue" onclick="checkAnswer(this)"></button>
        </div>

        <div id="feedback-area" class="hidden">
            <div class="recording-box">
                <button id="recBtn" class="rec-btn" onclick="toggleRecording()">ğŸ¤</button>
                <div style="color: #999; font-size: 14px; margin-bottom: 10px;">é»ä¸€ä¸‹é–‹å§‹éŒ„éŸ³</div>
                <button id="playRecBtn" class="play-voice-btn hidden" onclick="playBack()">â–¶ï¸ è½æˆ‘çš„è²éŸ³</button>
            </div>
            <button onclick="nextRound()" style="margin-top:20px; border:none; background:var(--accent); color:white; border-radius:25px; padding:15px 50px; font-size:22px; cursor:pointer; font-weight:bold; box-shadow: 0 5px #2e86de;">NEXT â”</button>
        </div>
        <button onclick="location.reload()" style="margin-top:30px; background:none; border:none; color:lightgray; cursor:pointer;">â¬… Back to Selection</button>
    </div>
</div>

<script>
    const victoryAudio = new Audio('https://www.myinstants.com/media/sounds/final-fantasy-vii-victory-fanfare-1.mp3');

    const longVowelsData = {
        'a_e': ["cake", "lake", "gate", "face", "game", "plate"],
        'i_e': ["bike", "kite", "five", "nice", "pine", "smile"],
        'o_e': ["bone", "rope", "home", "nose", "rose", "hole"],
        'u_e': ["tube", "cube", "mute", "cute", "mule", "june"],
        'ee': ["bee", "tree", "seed", "feet", "deep", "sleep"],
        'ea': ["leaf", "tea", "eat", "meat", "seal", "beach"]
    };

    let currentVowel = '', currentTarget = '', score = 0, isRecording = false;
    let mediaRecorder, audioChunks = [], audioUrl;

    function startLevel(vowel) {
        currentVowel = vowel;
        score = 0;
        document.getElementById('menu-view').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');
        // é€™è£¡å°‡æ¨™é¡Œæ”¹ç‚º Long Vowel: [æ¯éŸ³çµ„åˆ]
        document.getElementById('current-vowel-display').innerText = "Long Vowel: " + vowel;
        nextRound();
    }

    function nextRound() {
        const words = longVowelsData[currentVowel];
        currentTarget = words[Math.floor(Math.random() * words.length)];
        
        const otherVowels = Object.keys(longVowelsData).filter(v => v !== currentVowel);
        const randomVowel = otherVowels[Math.floor(Math.random() * otherVowels.length)];
        const distractor = longVowelsData[randomVowel][0];

        const options = [currentTarget, distractor].sort(() => Math.random() - 0.5);
        document.getElementById('opt1').innerText = options[0];
        document.getElementById('opt2').innerText = options[1];
        
        document.getElementById('feedback-area').classList.add('hidden');
        document.getElementById('playRecBtn').classList.add('hidden');
        document.getElementById('star-display').classList.remove('victory-jump');
        updateStars();
        speak(currentTarget);
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'en-US';
        m.rate = 0.8;
        window.speechSynthesis.speak(m);
    }

    function checkAnswer(el) {
        if (el.innerText === currentTarget) {
            score++;
            updateStars();
            document.getElementById('feedback-area').classList.remove('hidden');
            
            if (score > 0 && score % 5 === 0) {
                victoryAudio.currentTime = 0;
                victoryAudio.play();
                document.getElementById('star-display').classList.add('victory-jump');
            } else {
                playDing();
            }
        } else {
            speak("Try again");
        }
    }

    function updateStars() {
        let displayScore = score % 5;
        if (score > 0 && score % 5 === 0) displayScore = 5;
        document.getElementById('star-display').innerText = "â˜…".repeat(displayScore) + "â˜†".repeat(5 - displayScore);
    }

    function playDing() {
        const ctx = new AudioContext();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(523, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(659, ctx.currentTime + 0.1);
        g.gain.setValueAtTime(0.05, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        o.start(); o.stop(ctx.currentTime + 0.3);
    }

    function toggleRecording() {
        if (!isRecording) {
            audioChunks = [];
            mediaRecorder.start();
            isRecording = true;
            document.getElementById('recBtn').innerText = "â¹ï¸";
            document.getElementById('recBtn').style.background = "#333";
        } else {
            mediaRecorder.stop();
            isRecording = false;
            document.getElementById('recBtn').innerText = "ğŸ¤";
            document.getElementById('recBtn').style.background = "#ff5252";
        }
    }

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            audioUrl = URL.createObjectURL(audioBlob);
            document.getElementById('playRecBtn').classList.remove('hidden');
        };
    });

    function playBack() { new Audio(audioUrl).play(); }
</script>
</body>
</html>
